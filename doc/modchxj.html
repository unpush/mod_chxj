<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/REC-html401/loose.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="generator" content="SmartDoc 1.1">
<meta name="author" content="Atsushi Konno" lang="ja">
<meta name="date" content="29 Mar 2005" lang="ja">
<title>mod_chxj</title>
<style type="text/css">
<!--
/*
    article.css

    since   : Nov. 21, 1998
    version : Aug. 21, 2003
    author  : ASAMI, Tomoharu (asami@XMLSmartDoc.org)
*/

A:link {
  color: green;
}

A:visited {
  color: black;
}

A:hover{
  color: gold;
};

body {
  background: white;
  font-family: times, serif;
}

h1 {
}

h1.title {
  color: black;
  background: gold;
  text-align: center;
  border-style: outset;
  border-color: yellow;
  padding: 10pt;
  margin-left: 60pt;
  margin-right: 60pt;
}

h1.part {
  font-weight: bold;
  color: black;
  background: gold;
  padding: 20pt;
}

h1.chapter {
  color: tan;
  background: black;
  text-align: left;
  padding: 5pt;
}

h2 {
  color: bisque;
  background: #666666;
  padding: 3pt;
}

h3 {
  color: black;
  background: #aaaaaa;
  padding: 2pt;
  margin-right: 100pt;
}

h4 {
  color: black;
  background: #eeeeee;
  padding: 1pt;
  margin-right: 200pt;
}

dfn {
  font-weight: bold;
  font-style: normal;
}

code {
  font-family: helvetica, sans-serif;
  font-weight: bold;
}

li p {
  text-indent: 0pt;
}

dt {
  font-weight: bold;
}

th p {
  text-indent: 0pt;
}

td p {
  text-indent: 0pt;
}

div.table {
  text-align: center;
}

table.data {
  border-collapse: separate;
  text-align: justify;
  margin-left: auto;
  margin-right: auto;
  margin-top: 10pt;
  margin-bottom: 10pt;
  background-color: green;
}

table.data caption {
  background-color: khaki;
  font-weight: bold;
}

table.data th {
  color: yellow;
  background-color: lightseagreen;
}

table.data td {
  background-color: antiquewhite;
}

table.data td.key {
  background-color: salmon;
  font-weight: bold;
}


table.menu {
  text-align: justify;
  margin-left: auto;
  margin-right: auto;
  margin-top: 10pt;
  margin-bottom: 10pt;
  text-align: center;
}

table.menu caption {
  background-color: khaki;
  font-weight: bold;
}

table.menu th {
  color: yellow;
  background-color: lightseagreen;
}

table.menu td {
  color: Maroon;
  background-color: antiquewhite;
  font-weight: bold;
  padding: 10pt;
}

table.menu td.key {
  font-size: x-large;
  color: RoyalBlue;
  background-color: LightGreen;
  font-weight: bold;
  padding: 10pt;
}

table.menu td.key A:link {
  color: RoyalBlue;
}

table.menu td.key A:visited {
  color: RoyalBlue;
}

table.navigator {
  text-align: justify;
  margin-left: auto;
  margin-right: auto;
}

table.navigator td {
  text-align: center;
  font-weight: bold;
}

table.languages {
  text-align: justify;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 0pt;
  margin-top: 0pt;
  font-size: x-small;
  position: absolute;
  right: 0pt;
}

table.languages td.current {
}

table.languages td.other {
  background-color: Orange;
}

p {
  margin: 0pt;
  text-indent: 1em;
}

p.ja {
  margin: 0pt;
  text-indent: 1em;
}

p.first {
  margin: 0pt;
  text-indent: 0em;
}

p.first_ja {
  margin: 0pt;
  text-indent: 1em;
}

div.title {
  text-align: center;
}

span.title {
  font-size: larger;
}

span.subtitle {
  font-size: smaller;
}

div.toc {
  background-color: cornsilk;
  padding: 10pt;
  border-style: inset;
  border-color: cornsilk;
  margin-top: 10pt;
  margin-bottom: 30pt;
}

div.titletoc {
  background-color: cornsilk;
  padding: 10pt;
  border-style: inset;
  border-color: cornsilk;
  margin-top: 10pt;
  margin-bottom: 30pt;
}

div.date {
  text-align: center;
}

div.org {
  text-align: center;
}

div.author {
  text-align: center;
  font-weight: bold;
}

div.email {
  text-align: center;
}

div.hp {
  text-align: center;
}

div.summary {
  color: maroon;
  background: darkkhaki;
  border-style: inset;
  border-color: khaki;
  margin-top: 20pt;
  margin-bottom: 20pt;
  margin-left: 30pt;
  margin-right: 30pt;
  padding: 5pt;
}

div.comment {
  color: red;
  background: yellow;
}

span.comment {
  color: red;
  background: yellow;
}

div.navigator {
  background: khaki;
  border-top: 1pt solid black;
  border-bottom: 1pt solid black;
  text-align: center;
  margin-top: 10pt;
  margin-bottom: 10pt;
}

div.navigatortop {
  background: khaki;
  border-top: 1pt solid black;
  border-bottom: 1pt solid black;
  text-align: center;
  margin-bottom: 10pt;
}

div.navigatorbottom {
  background: khaki;
  border-top: 1pt solid black;
  border-bottom: 1pt solid black;
  text-align: center;
  margin-top: 10pt;
}

div.languages {
  text-align: right;
}

div.footnote {
  background: antiquewhite;
}

div.fyi {
  color: maroon;
  background: peachpuff;
  padding: 5pt;
  margin-top: 10pt;
  margin-bottom: 10pt;
}

div.fyi div.title {
  background: antiquewhite;
  font-weight: bold;
  padding: 5pt;
  margin-top: 5pt;
  margin-bottom: 5pt;
}

div.caption {
  background: lavender;
  font-weight: bold;
  padding: 5pd;
  width: 300pt;
  margin-top: 10pt;
}

div.result {
  background: ivory;
  border-style: inset;
  border-color: gold;
  padding: 10pt;
  margin-top: 10pt;
  margin-bottom: 10pt;
}

span.caption {
  background: lavender;
  font-weight: bold;
}

pre.program {
  background-color: gainsboro;
  font-family: courier, monospace;
  padding: 5pt;
  margin-right: 30pt;
}

pre.program em {
  color: red;
  font-style: normal;
}

pre.program strong {
  color: red;
  background-color: yellow;
  font-style: normal;
}

pre.program span.keyword {
  color: Blue;
  font-style: normal;
}

pre.program span.primitive {
  color: Green;
  font-style: normal;
}

pre.program span.comment {
  color: Red;
  background-color: gainsboro;
  font-style: normal;
}

pre.program span.quote {
  color: OrangeRed;
  font-style: normal;
}


pre.program span.class {
  color: darkcyan;
  font-style: normal;
}

pre.program span.constant {
  color: blueviolet;
  font-style: normal;
}

pre.program span.variable {
  color: DarkGoldenrod;
  font-style: normal;
}

var {
  color: green;
  font-style: italic;
}

tt {
  font-family: courier, monospace;
}

code {
  font-family: helvetica, sans-serif;
  font-weight: bold;
}

pre.console {
  background-color: black;
  color: white;
  font-family: courier, monospace;
  padding: 5pt;
  margin-right: 30pt;
}

pre.console kbd {
  font-family: courier, monospace;
  color: yellow;
}

span.toggle {
  font-weight: bold;
}

div.figure {
  text-align: center;
}

img.figure {
  margin: 10pt;
}

div.equation {
  margin-top: 1em;
  margin-right: 30pt;
  margin-bottom: 1em;
  padding-top: 1em;
  padding-left: 4em;
  padding-bottom: 1em;
  background: powderblue;
}

div.equation table {
}

div.equation table td.padding {
  width:2em
}

td.equationNumber {
  width: 4em;
  text-align: right;
}
-->
</style>
<script type="text/javascript">
<!--
/*
 * HTML4JavaScript.js
 *
 * @since   Nov. 17, 1998
 * @version Feb. 18, 2002
 * @author  ASAMI, Tomoharu (asami@XMLSmartDoc.org)
 */
var backupColor=null;
var backupBGColor=null;
var backupFontStyle=null;
var backupIDColor=null;
var backupIDBGColor=null;
var backupIDFontStyle=null;
var backupIDBorderStyle=null;

var backupOnKeyDown=null;

function normal(element) {
  if (document.all) {
    if (backupColor != null) {
      element.style.color=backupColor;
      backupColor=null;
    }
    if (backupBGColor != null) {
      element.style.background=backupBGColor;
      backupBGColor=null;
    }
    if (backupFontStyle != null) {
      element.style.fontStyle=backupFontStyle;
      backupFontStyle=null;
    }
    var id = null;
    if (element.href != null) {
      id = element.href;
      id = id.substring(id.indexOf("#") + 1);
    }
    if (id != null) {
      var target = document.all.item(id, 0);
      if (backupIDColor != null) {
        target.style.color=backupIDColor;
        backupIDColor=null;
      }
      if (backupIDBGColor != null) {
        target.style.background=backupIDBGColor;
        backupIDBGColor=null;
      }
      if (backupIDFontStyle != null) {
        target.style.fontStyle=backupIDFontStyle;
        backupIDFontStyle=null;
      }
      if (backupIDBorderStyle != null) {
        target.style.borderStyle=backupIDBorderStyle;
        backupIDBorderStyle=null;
      }
    }
  }
}

function hilight(element) {
  if (document.all) {
    backupBGColor=element.style.background;
    element.style.background="gold";
  }
}

function hilightString(element, color) {
  if (color == null) {
    color="darkolivegreen";
  }
  if (document.all) {
    backupColor=element.style.color;
    backupFontStyle=element.style.fontStyle;
    element.style.color=color;
  }
}

function hilightSelflink(element, color) {
  if (color == null) {
    color="darkolivegreen";
  }
  if (document.all) {
    backupColor=element.style.color;
    backupBGColor=element.style.background;
    backupFontStyle=element.style.fontStyle;
    element.style.color=color;
    var id = null;
    if (element.href != null) {
      id = element.href;
      id = id.substring(id.indexOf("#") + 1);
    }
    if (id != null) {
      var target = document.all.item(id, 0);
      backupIDColor=target.style.color;
//      backupIDBGColor=target.style.background;
//      backupIDFontStyle=target.style.fontStyle;
      backupIDBorderStyle=target.style.borderStyle;
      target.style.color="red";
      target.style.borderStyle="outset";
    }
  }
}

function hilightHyperlink(element, color) {
  if (color == null) {
    color="darkorange";
  }
  if (document.all) {
    backupColor=element.style.color;
    backupBGColor=element.style.background;
    backupFontStyle=element.style.fontStyle;
    element.style.color=color;
  }
}

function hilightExternallink(element, color) {
  if (color == null) {
    color="purple";
  }
  if (document.all) {
    backupColor=element.style.color;
    backupBGColor=element.style.background;
    backupFontStyle=element.style.fontStyle;
    element.style.color=color;
  }
}

function toggleChildren(node) {
  if (document.all) {
    for (i = 0;i < node.children.length;i++) {
      var child = node.children[i];
      if (child.className == "dynamic") {
        if (child.style.display == "") {
            child.style.display = "none";
        } else {
            child.style.display = "";
        }
      }
    }
  }
}

function toggleDynamic(node) {
  if (document.all) {
    if (node.tagName == "LI") {
      toggleChildren(node);
    }
  }
}

function isMsie4orGreater() { 
  var ua = window.navigator.userAgent; var msie = ua.indexOf ("MSIE");
  if (msie > 0) {
    return (parseInt (ua.substring (msie+5, ua.indexOf (".", msie))) >= 4)   
      && (ua.indexOf ("MSIE 4.0b") <0);
  } else {
    return false;
  }
}

function keyEventHandler() {
  if (document.all) {
    if (event.keyCode == 13) {
      var child = document.all.item("doc_next_page_", 0);
      if (child != null) {
        location.href = child.href;
      }
    } else if (event.keyCode == 39) {
      var child = document.all.item("doc_next_page_", 0);
      if (child != null) {
        location.href = child.href;
      }
    } else if (event.keyCode = 37) {
      var child = document.all.item("doc_prev_page_", 0);
      if (child != null) {
        location.href = child.href;
      }
    } else {
      backupOnKeyDown();
    }
  }
}

function setOHPHandler() {
  backupOnKeyDown=document.onkeydown;
  document.onkeydown=keyEventHandler;
}
// -->
</script>
</head>
<body>
<div style="text-align:right"><a href="http://www.XMLSmartDoc.org" target="_top"><span style="color:#4F5952;background:#EE8362;font-family:sans-serif;font-size:xx-small;text-decoration:none">Powered by </span><span style="color:#058258;background:#EE8362;font-family:fantasy, sans-serif;font-size:x-small;text-decoration:none">SmartDoc</span></a></div>

<h1 class="title">mod_chxj<br><span class="subtitle"></span></h1>

<div class="date">29 Mar 2005</div>
<div class="author">Atsushi Konno</div>
<h2>目次</h2>

<div class="toc">
<ul>
<li> <a href="#doc1_15" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Overview</a>
<li> <a href="#doc1_18" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">インストール</a>
<ul>
<li> <a href="#doc1_20" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">準備</a>
<li> <a href="#doc1_47" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">mod_chxjの入手</a>
<li> <a href="#doc1_53" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">インストール</a>
</ul>
<li> <a href="#doc1_102" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Configuration</a>
<ul>
<li> <a href="#doc1_104" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">htmlファイルが変換対象の場合</a>
<li> <a href="#doc1_119" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">php等の出力結果が変換対象の場合</a>
<li> <a href="#doc1_134" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">xoopsを使用し、且つwordpress、bwikiを使用している場合</a>
<li> <a href="#doc1_149" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">画像自動変換機能を使用する場合</a>
<li> <a href="#doc1_214" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">文字コードを変換したい場合(EXPERIMENTAL)</a>
<li> <a href="#doc1_258" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">ディレクティブ</a>
</ul>
<li> <a href="#doc1_375" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">対応するCHTMLタグ</a>
<li> <a href="#doc1_1083" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">独自拡張タグ</a>
<li> <a href="#doc1_1120" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">文字コード</a>
<li> <a href="#doc1_1123" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">絵文字について</a>
<ul>
<li> <a href="#doc1_1128" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">絵文字変換定義</a>
</ul>
<li> <a href="#doc1_1173" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">デバイス定義 device_data.xml</a>
<li> <a href="#doc1_1176" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">イメージ画像変換機能</a>
<ul>
<li> <a href="#doc1_1185" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">サムネイルモード</a>
<li> <a href="#doc1_1191" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">壁紙モード</a>
<li> <a href="#doc1_1197" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">EzGetモード</a>
<li> <a href="#doc1_1203" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">その他の機能</a>
</ul>
<li> <a href="#doc1_1234" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">ＱＲコード出力機能</a>
<ul>
<li> <a href="#doc1_1236" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">ＱＲコード出力ハンドラの登録</a>
<li> <a href="#doc1_1242" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">ＱＲコードソースファイルの設置</a>
<li> <a href="#doc1_1266" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">ＱＲコードの動的出力機能</a>
</ul>
<li> <a href="#doc1_1273" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Cookieシミュレート機能(EXPERIMENTAL)</a>
<ul>
<li> <a href="#doc1_1275" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Cookieシミュレート機能(EXPERIMENTAL)</a>
<li> <a href="#doc1_1281" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">One-Time ID</a>
<li> <a href="#doc1_1284" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Cookieの保存場所</a>
<li> <a href="#doc1_1290" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Cookieの保持期間</a>
</ul>
<li> <a href="#doc1_1297" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Refererシミュレート機能(EXPERIMENTAL)</a>
<ul>
<li> <a href="#doc1_1299" onmouseover="hilightSelflink(this)" onmouseout="normal(this)">Refererシミュレート機能(EXPERIMENTAL)</a>
</ul>
</ul>
</div>

<h2 id="doc1_15">Overview</h2>

<p class="first_ja">mod_chxjはオープンソースの携帯向けコンテンツ変換Apache2.0用モジュールであり、CHTML（DoCoMo i-Mode用CHTML3.0)で記述された文書や通常のHTMLで記述された文書を、アクセスに来た端末のUser-Agentヘッダを見て、それぞれの端末にあった形式に変換します。HTML文書に限らず、画像（jpg、gif、png）、絵文字についても、定義ファイルに従ってそれぞれのキャリアにあった絵文字に変換します。Cookie非対応端末、Refer非対応端末のために、Set-Cookie、CookieヘッダやRefererヘッダをシミュレートすることもできます（EXPERIMENTAL)。</p>

<h2 id="doc1_18">インストール</h2>


<h3 id="doc1_20">準備</h3>

<p class="first_ja">mod_chxjをインストールする前に、下記のものを用意する必要があります。</p>

<ol>
<li> Apache2.0のヘッダーファイル群
<li> Apache2.0用のapxs
<li> apr(Apache Portable Runtime)ライブラリとそのヘッダファイル郡(apu含む)
<li> automake、autoconf、libtool1.3.X
<li> ImageMagick(MagickWand)
<li> libiconvまたはlibiconv_hook
<li> Linux</ol>


<h3 id="doc1_47">mod_chxjの入手</h3>

<p class="first_ja">mod_chxjは<a href="http://sourceforge.jp/projects/modchxj/" target="_top" onmouseover="hilightExternallink(this)" onmouseout="normal(this)">こちら</a>からダウンロードすることができます。</p>

<h3 id="doc1_53">インストール</h3>

<p class="first_ja">以下にmod_chxjインストール手順を示します。</p>

<ol>
<li> <p>Configureスクリプトを生成します</p>

<div id="doc1_59" class="caption">Configure スクリプトの生成</div>
<pre class="program" style="margin-top:0">
$ ./buildconf.sh
</pre>

<p><span class="note"><a href="#doc1_62" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="&quot;$&quot;はプロンプトをあらわします。"><sup>(1)</sup></a></span></p>
<li> <p>Configure</p>
<p>以下は、/usr/include/apache2.0に、Apache2.0のヘッダーファイルが存在する場合です。</p>

<div id="doc1_68" class="caption">Configure</div>
<pre class="program" style="margin-top:0">
$ ./configure --with-apache-header=/usr/include/apache2.0
</pre>

<p><span class="note"><a href="#doc1_71" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="--with-apache-headerは必須です。"><sup>(2)</sup></a></span><span class="note"><a href="#doc1_74" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="FreeBSD等の場合は--with-iconvも必須です。"><sup>(3)</sup></a></span><span class="note"><a href="#doc1_77" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="場合によっては--with-aprや--with-apuも必要です。"><sup>(4)</sup></a></span></p>
<li> mod_chxj.soを生成します
<div id="doc1_83" class="caption">make</div>
<pre class="program" style="margin-top:0">
$ make
</pre>
<li> apacheにインストールします
<div id="doc1_89" class="caption">install</div>
<pre class="program" style="margin-top:0">
$ make install
</pre>
<li> <p>データの設置etcディレクトリは以下のdevice_data.xmlとemoji.xmlをApacheからアクセスできるところに配置します。</p>
<p>以下、/etc/apache2/chxjディレクトリにchxj用設定ファイルを用意する場合</p>

<div id="doc1_95" class="caption">データの設置</div>
<pre class="program" style="margin-top:0">
$ mkdir -p /etc/apache2/chxj
$ cp etc/device_data.xml /etc/apache2/chxj
$ cp etc/emoji.xml /etc/apache2/chxj
</pre></ol>


<div class="footnote">
<ol>
<li id="doc1_62" value="1"> &quot;$&quot;はプロンプトをあらわします。<li id="doc1_71" value="2"> --with-apache-headerは必須です。<li id="doc1_74" value="3"> FreeBSD等の場合は--with-iconvも必須です。<li id="doc1_77" value="4"> 場合によっては--with-aprや--with-apuも必要です。</ol>
</div>


<h2 id="doc1_102">Configuration</h2>

<p class="first_ja">以下はmod_chxjが/usr/lib/apache2/modulesディレクトリ配下に設置されたものとしています</p>

<h3 id="doc1_104">htmlファイルが変換対象の場合</h3>

<p class="first_ja">例として、Locationが&quot;/chxj&quot;以下のものは全て変換する場合を説明します。</p>

<ol>
<li> httpd.confに以下を追加します。
<div id="doc1_110" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
#====================================================================================
# モジュールをApache2.0にロード
#====================================================================================
LoadModule chxj_module /usr/lib/apache2/modules/mod_chxj.so

#====================================================================================
# デバイスデータファイルの設定
#====================================================================================
ChxjLoadDeviceData  /etc/apache2/chxj/device_data.xml

#====================================================================================
# 絵文字データファイルの設定
#====================================================================================
ChxjLoadEmojiData   /etc/apache2/chxj/emoji.xml

#====================================================================================
# 変換エンジン動作指示命令（下記のSetOutputFilter、SetInputFilterも必須です)
# ChxjConvRule ==&gt; ディレクティブ
# &quot;^/chxj.+$&quot;  ==&gt; Perl互換のURIパターン
# EngineOn     ==&gt; 変換エンジンを動作させる指示
# NONE         ==&gt; サーバ側の文字コード。（NONEを指定した場合は文字コード変換しない)
#====================================================================================
ChxjConvertRule &quot;^/chxj.+$&quot; &quot;EngineOn&quot; &quot;NONE&quot;
</pre>
<li> apacheの再起動。</ol>


<h3 id="doc1_119">php等の出力結果が変換対象の場合</h3>


<ol>
<li> httpd.confに以下を追加します
<div id="doc1_125" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
#====================================================================================
# モジュールをApache2.0にロード
#====================================================================================
LoadModule chxj_module /usr/lib/apache2/modules/mod_chxj.so

#====================================================================================
# デバイスデータの設定
#====================================================================================
ChxjLoadDeviceData  /etc/apache2/chxj/device_data.xml

#====================================================================================
# 絵文字データの設定
#====================================================================================
ChxjLoadEmojiData   /etc/apache2/chxj/emoji.xml

#====================================================================================
# 変換エンジン動作指示命令（下記のSetOutputFilter、SetInputFilterも必須です)
# ChxjConvRule ==&gt; ディレクティブ
# &quot;^/chxj.+$&quot;  ==&gt; Perl互換のURIパターン
# EngineOn     ==&gt; 変換エンジンを動作させる指示。動作させたく無い場合は&quot;EngineOff&quot;
# EUC-JP       ==&gt; サーバ側の文字コード。（NONEを指定した場合は文字コード変換しない)
#                  EUC-JPからCP932に文字コード変換します。
#====================================================================================
ChxjConvertRule &quot;^/chxj.+$&quot; &quot;EngineOn&quot; &quot;EUC-JP&quot;
</pre>
<li> apacheの再起動。</ol>


<h3 id="doc1_134">xoopsを使用し、且つwordpress、bwikiを使用している場合</h3>


<ol>
<li> httpd.confに以下を追加します
<div id="doc1_140" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
#====================================================================================
# モジュールをApache2.0にロード
#====================================================================================
LoadModule chxj_module /usr/lib/apache2/modules/mod_chxj.so

#====================================================================================
# デバイスデータの設定
#====================================================================================
ChxjLoadDeviceData  /etc/apache2/chxj/device_data.xml

#====================================================================================
# 絵文字データの設定
#====================================================================================
ChxjLoadEmojiData   /etc/apache2/chxj/emoji.xml

#====================================================================================
# 変換エンジン動作指示命令（下記のSetOutputFilter、SetInputFilterも必須です)
#====================================================================================
#====================================================================================
# bwikiの設定をします。bwikiではどうもxoopsヘッダの文字コードとbwiki内での携帯スキン
# の文字コードが一致していないようなので、bwiki内で文字コードを変換させないように
# 修正後、以下のルールを記述します。
# 
# ChxjConvRule           ディレクティブ
# &quot;^/modules/bwiki.+$&quot;   このルールを適用したいURIパターン
# &quot;EngineOn&quot;             変換エンジンを有効にします。
# &quot;EUC-JP&quot;               出力時にEUC-JPからCP932に変換させます。
# &quot;PC&quot;                   変換元HTMLはPCサイト用HTMLです。
# &quot;DoCoMo/1.0/D501i&quot;     DoCoMo端末としてbwikiにアクセスさせます。
#
#====================================================================================
ChxjConvertRule &quot;^/modules/bwiki.+$&quot; &quot;EngineOn&quot; &quot;EUC-JP&quot; &quot;PC&quot; \
    &quot;DoCoMo/1.0/D501i&quot;

#====================================================================================
# wordpressの設定をします。
# 
# ChxjConvRule               ディレクティブ
# &quot;^/modules/wordpress.+$&quot;   このルールを適用したいURIパターン
# &quot;EngineOn&quot;                 変換エンジンを有効にします。
# &quot;NONE&quot;                     出力時に文字コード変換をさせません。
# &quot;NONE&quot;                     変換元HTMLはPCサイト用HTMLではありません。
# &quot;DoCoMo/1.0/D501i&quot;         DoCoMo端末としてwordpressにアクセスさせます。
#
#====================================================================================
ChxjConvertRule &quot;^/modules/wordpress/.*$&quot; &quot;EngineOn&quot; &quot;NONE&quot; &quot;PC&quot; \
    &quot;DoCoMo/1.0/D501i&quot;

#====================================================================================
# その他の設定をします。
# 
# ChxjConvRule               ディレクティブ
# &quot;^/.+$&quot;                    このルールを適用したいURIパターン
# &quot;EngineOn&quot;                 変換エンジンを有効にします。
# &quot;EUC-JP&quot;                   出力時にEUC-JPからCP932に文字コード変換をさせます。
#
#====================================================================================
ChxjConvertRule &quot;^/.+$&quot; &quot;EngineOn&quot; &quot;EUC-JP&quot; 


&lt;Location /&gt;
  ChxjImageEngine On
  AllowOverride All
&lt;/Location&gt;
</pre>
<li> apacheの再起動。</ol>


<h3 id="doc1_149">画像自動変換機能を使用する場合</h3>


<ol>
<li> <p>httpd.confに以下を追加します。下記は、URIが/imgで始まる全ての画像に対して動作するようmod_chxjに指示しています。</p>

<div id="doc1_155" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
&lt;Location /img&gt;
ChxjImageEngine On
ChxjImageCacheDir /tmp
ChxjImageCopyright &quot;A.Konno&quot;
&lt;/Location&gt;
</pre>

<p>上記の説明を以下に示します。</p>

<ol>
<li> <p>ChxjImageEngine<br></br> mod_chxjの画像変換ハンドラを起動するよう指示しています。DefaultはOff</p>
<p><br></br> <br></br></p>
<li> <p>ChxjImageCacheDir<br></br> mod_chxj画像変換ハンドラが使用する変換後の画像をおいておくディレクトリを指定します。デフォルトは/tmp。</p>

<div id="doc1_173" class="caption">ChxjImageCacheDir</div>
<pre class="program" style="margin-top:0">
      ChxjImageCacheDir /tmp
      
</pre>

<p>mod_chxjに画像変換キャッシュとして/tmpを使用するよう指示します。<br></br><br></br></p>
<li> <p>ChxjImageCopyright<br></br> mod_chxjの画像変換ハンドラに、転送禁止設定を行うよう指示します。パラメータとして任意の文字列をとります。ChxjImageCopyrightディレクティブで指定された文字列は、それぞれのイメージのコメント部に埋め込まれます。</p>

<div id="doc1_185" class="caption">ChxjImageCopyright</div>
<pre class="program" style="margin-top:0">
      ChxjImageCopyright &quot;A.Konno&quot;
      
</pre>

<p>mod_chxjに転送禁止設定を行うよう指示しています。変換後イメージのコメント部分には、キャリア毎に以下の文字列を埋め込みます。</p>
<p><b>AU の場合</b></p>

<div id="doc1_191" class="caption">AU</div>
<pre class="program" style="margin-top:0">
       kddi_copyright=on,A.Konno
       
</pre>

<p><b>DoCoMoの場合</b></p>

<div id="doc1_197" class="caption">DoCoMo</div>
<pre class="program" style="margin-top:0">
copy=&quot;NO&quot;,A.Konno
</pre>

<p><b>Vodafone</b>の場合は、レスポンスヘッダに</p>

<div id="doc1_203" class="caption">Vodafone/J-PHONE</div>
<pre class="program" style="margin-top:0">
         x-jphone-copyright:no-transfer
       
</pre>

<p>を埋め込みます。<span class="note"><a href="#doc1_206" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="Vodafoneの場合は、リクエストＵＲＬの最後が.pnzか、.jpzで終わるようにダミーを付けなければなりません。"><sup>(5)</sup></a></span></p></ol></ol>


<div class="footnote">
<ol>
<li id="doc1_206" value="5"> Vodafoneの場合は、リクエストＵＲＬの最後が.pnzか、.jpzで終わるようにダミーを付けなければなりません。</ol>
</div>


<h3 id="doc1_214">文字コードを変換したい場合(EXPERIMENTAL)</h3>


<ol>
<li> <p>httpd.confに以下を追加します。下記は、URIが/chxjで始まる全てのコンテンツに対して動作するようmod_chxjに指示しています。サーバ側はEUC-JPであった場合の例です。mod_chxjによってSJISに変換するように指示しています。</p>

<div id="doc1_220" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
ChxjConvRule &quot;^/chxj.+$&quot; &quot;EngineOn&quot; &quot;EUC-JP&quot;
</pre>

<p>上記の説明を以下に示します。</p>

<ol>
<li> <p>ChxjConvertRule<br></br>サーバサイドの文字コードを指定します。ここに、EUC-JPと指定してあった場合は、EUC-JPからCP932に変換後、クライアントに出力されます。省略した場合はNONE</p>

<ol>
<li> 変換エンジン動作指示命令（下記のSetOutputFilter、SetInputFilterも必須です)<br></br> ChxjConvertRule ==&gt;ディレクティブ<br></br>&quot;^/chxj.+$&quot; ==&gt; Perl互換のURIパターン<br></br>EngineOn ==&gt;変換エンジンを動作させる指示。動作させたく無い場合は&quot;EngineOff&quot;<br></br> EUC-JP ==&gt;サーバ側の文字コード。（NONEを指定した場合は文字コード変換しない)<br></br> <br></br> EUC-JPからCP932に文字コード変換します。(libiconvに依存します)<br></br></ol>

<p><br></br><br></br></p></ol></ol>


<h3 id="doc1_258">ディレクティブ</h3>


<ol>
<li> ChxjLoadDeviceData<br></br>デバイス定義ファイルを指定します。
<div id="doc1_266" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjLoadDeviceData /etc/apache2/device.xml
  
</pre>
<li> ChxjLoadEmojiData<br></br>絵文字変換定義ファイルを指定します。
<div id="doc1_274" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjLoadEmojiData   /etc/apache2/chxj/emoji.xml
  
</pre>
<li> ChxjImageEngine<br></br>画像変換エンジンを有効にします。パラメータとしてOnとOffを指定できます。DefaultはOffです。
<div id="doc1_282" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjImageEngine On
  
</pre>
<li> ChxjImageCacheDir<br></br>イメージの一時ファイル保存場所を指定します。
<div id="doc1_290" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjImageCacheDir   /tmp
  
</pre>
<li> ChxjImageCopyright<br></br>イメージに著作権情報を付与します。
<div id="doc1_298" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjImageCacheDir   &quot;chosakuken jyoho&quot;
  
</pre>
<li> ChxjConvertRule<br></br> HTML変換エンジンの適用ルールを記述します。本ディレクティブを使用し、変換エンジンのOn|Offを指定します。DefaultはOFFです。また、ルールは記述された順番に評価し、マッチするものがあれば、その時点で対象ルールを適用します。パラメータは3つ必要です。下記にパラメータを記します。
<div class="table">
<table id="doc1_306" class="data" rules="groups">
<caption>パラメータ</caption>
<colgroup span="2">
<col>
<col>
</colgroup>
<tbody>
<tr class="even">
<td>第1パラメータ</td>
<td>URIを評価するPerl互換の正規表現を指定します</td>
</tr>
<tr class="odd">
<td>第2パラメータ</td>
<td>HTML変換エンジンのOn|Offを指定します。Onの場合は&quot;EngineOn&quot;。Offの場合は&quot;EngineOff&quot;を指定します。&quot;EngineOn|EngineOff&quot;の他に&quot;CookieOn|CookieOff&quot;を指定することもできます。複数指定する場合は&quot;,&quot;で区切って指定します。</td>
</tr>
<tr class="even">
<td>第3パラメータ</td>
<td>文字コードを指定します。ここで指定した文字コードから&quot;CP932&quot;に変換します。指定できる文字コードはiconv -lコマンドによって確認することができます。変換しなくて良い場合はNONEを指定してください。</td>
</tr>
<tr class="odd">
<td>第4パラメータ</td>
<td>省略した場合は、携帯ページからの変換を意味します。PC用ページからの変換を行う場合は&quot;PC&quot;を第四パラメータに指定します。</td>
</tr>
<tr class="even">
<td>第5パラメータ</td>
<td>サーバサイドアプリケーションに渡すUser-Agentを指定します。例えば、wordpress等のようにCHTMLを出力するアプリケーションがある場合は、&quot;DoCoMo/1.0/N501i&quot;等適当なUser-Agentを指定することによって、アプリケーションにCHTMLを出力するように指示することができます。ここで指定したUser-AgentはHTML出力時には評価されません。</td>
</tr>
</tbody>
</table>
</div>


<div id="doc1_352" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    ChxjConvertRule &quot;^/chxj.+$/&quot; EngineOn EUC-JP
  
</pre>
<li> <p>ChxjCookieDir<br></br>クッキーを使用する場合に指定します。クッキーの内容を保存するディレクトリを指定します。指定しない場合は/tmpに保存されます。</p>

<div id="doc1_360" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    &lt;Location /&gt;
      ChxjCookieDir   /tmp
    &lt;/Location&gt;
  
</pre>

<p>詳細は「Cookieシミュレート機能」の項を参照ください。</p>
<li> <p>ChxjCookieTimeout<br></br>クッキーを使用する場合に指定します。クッキーの保持期間を秒単位で指定します。指定しない場合は、1800秒でクッキーデータを破棄します。</p>

<div id="doc1_368" class="caption">ex)</div>
<pre class="program" style="margin-top:0">
    &lt;Location /&gt;
      ChxjCookieTimeout 10
    &lt;/Location&gt;
  
</pre>

<p>詳細は「Cookieシミュレート機能」の項を参照ください。</p></ol>


<h2 id="doc1_375">対応するCHTMLタグ</h2>

<p class="first_ja">変換可能なＣＨＴＭＬタグは以下のとおりです。</p>

<div class="table">
<table id="doc1_377" class="data" rules="groups">
<caption>対応タグ一覧</caption>
<colgroup span="7">
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr class="even">
<td>タグ</td>
<td>属性</td>
<td>CHTML</td>
<td>HDML</td>
<td>XHTML</td>
<td>JHTML</td>
<td>備考</td>
</tr>
</thead>
<tbody>
<tr class="even">
<td>&lt;HTML&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">属性を指定した場合は無視します</td>
</tr>
<tr class="odd">
<td>&lt;META&gt;</td>
<td align="center">http-equiv</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">CHTML1.0、HDMLでは無視します</td>
</tr>
<tr class="even">
<td></td>
<td align="center">content</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">CHTML1.0、HDMLでは無視します</td>
</tr>
<tr class="odd">
<td>&lt;HEAD&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">△</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">属性を指定した場合は無視します</td>
</tr>
<tr class="even">
<td>&lt;TITLE&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">属性を指定した場合は無視します</td>
</tr>
<tr class="odd">
<td>&lt;BASE&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDMLでは無視します</td>
</tr>
<tr class="even">
<td>&lt;BODY&gt;</td>
<td align="center">bgcolor</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDML、CHTML1.0、CHTML2.0では無視します</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">text</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDML、CHTML1.0、CHTML2.0では無視します</td>
</tr>
<tr class="even">
<td></td>
<td align="center">link</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDML、CHTML1.0、CHTML2.0では無視します</td>
</tr>
<tr class="odd">
<td>&lt;A&gt;</td>
<td align="center">href</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td></td>
<td align="center">accesskey</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>&lt;BR&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>&lt;FONT&gt;</td>
<td align="center">color</td>
<td align="center">△</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDML,CHTML1.0では無視します</td>
</tr>
<tr class="odd">
<td>&lt;FORM&gt;</td>
<td align="center">action</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td></td>
<td align="center">method</td>
<td align="center">○</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDMLでは無視します</td>
</tr>
<tr class="odd">
<td>&lt;INPUT&gt;</td>
<td align="center">name</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td></td>
<td align="center">type</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">text,password,hidden,radio,checkbox,submitに対応</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">value</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td></td>
<td align="center">istyle</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>&lt;SELECT&lt;</td>
<td align="center">name</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td></td>
<td align="center">size</td>
<td align="center">○</td>
<td align="center">&times;</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">HDMLでは無視します</td>
</tr>
<tr class="odd">
<td>&lt;OPTION&gt;</td>
<td align="center">value</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"><span class="note"><a href="#doc1_932" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="必ず閉じてください。そのうち対応します。"><sup>(7)</sup></a></span></td>
</tr>
<tr class="even">
<td></td>
<td align="center">checked</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>&lt;DIV&gt;</td>
<td align="center">align</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>&lt;HR&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>&lt;CENTER&gt;</td>
<td align="center"></td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>&lt;IMG&gt;</td>
<td align="center">src</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>&lt;CHXJ:IF&gt;</td>
<td align="center">lang</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="center">○</td>
<td align="left">lang=&quot;chtml&quot; lang=&quot;xhtml&quot; lang=&quot;hdml&quot; lang=&quot;jhtml&quot;が指定できます</td>
</tr>
</tbody>
</table>
</div>


<div class="footnote">
<ol>
<li id="doc1_932" value="7"> 必ず閉じてください。そのうち対応します。</ol>
</div>


<h2 id="doc1_1083">独自拡張タグ</h2>


<ol>
<li> <p>&lt;CHXJ:IF&gt;<br></br></p>
<p>&lt;CHXJ:IF&gt;タグと&lt;/CHXJ:IF&gt;タグではさまれたタグやテキストは、変換せずに<b>そのまま</b><span class="note"><a href="#doc1_1093" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="変換しませんので注意が必要です"><sup>(8)</sup></a></span>出力します。必須の属性としてlangがあります。lang属性を指定することによって、例えば、<b>「HDML機の場合のみ出力させる」</b>といったことを可能にします。<br></br><br></br>ex)</p>

<div id="doc1_1103" class="caption">HTML文書中にHDML機の場合のみ有効にしたいタグ、または文書がある場合</div>
<pre class="program" style="margin-top:0">
       &lt;CHXJ:IF lang=&quot;HDML&quot; &gt;
         &lt;NODISPLAY&gt;
&lt;ACTION TYPE=ACCEPT TASK=GOSUB \
    DEST='device:data/dnld?url=abc&amp;name=abc.jpg&amp;size=100&amp;disposition=devjaww&amp;title=test'&gt; \
         &lt;/NODISPLAY&gt;
       &lt;/CHXJ:IF&gt;
       
</pre>

<p><br></br></p>
<p>ex)</p>

<div id="doc1_1107" class="caption">i-Modeのみ出力したい文書がある場合</div>
<pre class="program" style="margin-top:0">
       &lt;CHXJ:IF lang=&quot;chtml&quot; &gt;
         シークレットコードがどーのこーの。
       &lt;/CHXJ:IF&gt;
       
</pre>

<p><br></br></p>
<p>また、lang属性は、複数指定することも可能です。<br></br></p>

<div id="doc1_1113" class="caption">HDML機,J-PHONE機は以下を出力します</div>
<pre class="program" style="margin-top:0">
       &lt;CHXJ:IF lang=&quot;chtml&quot; lang=&quot;jhtml&quot;&gt;
       あなたの携帯は、HDML機かJ-HTML機です。
       &lt;/CHXJ:IF&gt;
       
</pre>

<p><br></br></p></ol>


<div class="footnote">
<ol>
<li id="doc1_1093" value="8"> 変換しませんので注意が必要です</ol>
</div>


<h2 id="doc1_1120">文字コード</h2>

<p class="first_ja">文字コードは、絵文字の入出力がある関係上、Shift_JISのみとしています。</p>

<h2 id="doc1_1123">絵文字について</h2>

<p class="first_ja">i-Mode用の絵文字を書いておけば、アクセスしたキャリアによって、mod_chxjが対応の絵文字に自動変換します。ソースに2byteのバイナリコードを直接書いても、１０進参照文字列<span class="note"><a href="#doc1_1125" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="１６進参照文字列には対応していません"><sup>(9)</sup></a></span>（&amp;#XXX;の形）で書いても、どちらでも変換対象になります。１０進参照文字列で書いた場合は、mod_chxjにより、自動で２バイトコードに変換します。</p>

<div class="footnote">
<ol>
<li id="doc1_1125" value="9"> １６進参照文字列には対応していません</ol>
</div>


<h3 id="doc1_1128">絵文字変換定義</h3>

<p class="first_ja">絵文字の変換に関する動作を変えたい場合（例えば「ハートがあったら、ＡＵの場合はスペードに」とか、「変換定義がおかしい」といった場合）は、emoji.xmlファイルを直接編集することによって定義を変更することが可能です。emoji.xmlはXMLファイルとなっていますので、vi等で簡単に定義を変更することができます<span class="note"><a href="#doc1_1130" onmouseover="hilightSelflink(this)" onmouseout="normal(this)" title="厳密にはXMLになっていないので、日本語の記述はＳＪＩＳでお願いします。"><sup>(10)</sup></a></span>。</p>
<p><br></br>以下に、emoji.xmlファイルの一部を記します。</p>

<div id="doc1_1135" class="caption">emoji.xml</div>
<pre class="program" style="margin-top:0">
&lt;?xml encoding=&quot;Shift_JIS&quot; &gt;

&lt;emoji&gt;
  &lt;set&gt;
    &lt;no&gt;1&lt;/no&gt;
    &lt;imode&gt;
      &lt;hex1&gt;f8&lt;/hex1&gt;
      &lt;hex2&gt;9f&lt;/hex2&gt;
      &lt;string&gt;&amp;#63647;&lt;/string&gt;
      &lt;description&gt;&lt;/description&gt;
    &lt;/imode&gt;
    &lt;ezweb&gt;
      &lt;A&gt;44&lt;/A&gt;
      &lt;B&gt;44&lt;/B&gt;
      &lt;C&gt;44&lt;/C&gt;
      &lt;D&gt;44&lt;/D&gt;
    &lt;/ezweb&gt;
    &lt;jphone&gt;
      &lt;string&gt;$Gj&lt;/string&gt;
    &lt;/jphone&gt;
  &lt;/set&gt;
</pre>

<p>絵文字の定義は、&lt;emoji&gt;タグから&lt;/emoji&gt;タグまでの間にあります。その中の要素を説明します。１つの絵文字につき、１つのセット（&lt;set&gt;タグから&lt;/set&gt;タグまで）とし、キャリア毎の絵文字を定義しています。</p>

<ol>
<li> &lt;imode&gt;要素<br></br>まず、元となるi-Mode用の絵文字は、&lt;imode&gt;タグにはさまれた間に定義されています。&lt;imode&gt;要素は、２バイトコード要素(&lt;hex1&gt;&lt;hex2&gt;)と、１０進参照文字列要素(&lt;string&gt;)を保持していて、この２つの要素を変換元の値として使用します。アクセスしてきた端末が、i-Mode機であった場合で、かつＣＨＴＭＬ中に１０進参照文字列が絵文字として書かれている場合には、&lt;hex1&gt;&lt;hex2&gt;要素に定義されている値に置換します。
<br></br><br></br><li> &lt;ezweb&gt;要素<br></br>アクセスしてきた端末が、AU機であった場合、&lt;ezweb&gt;要素に定義されている値に変換します。&lt;ezweb&gt;要素は、&lt;A&gt;〜&lt;D&gt;要素を持っていて、それぞれAUの絵文字タイプＡ〜Ｄに対応していますので、もし、Ｄタイプの絵文字端末であったなら、&lt;D&gt;要素に定義されている値に変換します。ここで定義されている値は、HDML機の場合は、<b>&lt;IMG ICON=&quot;XX&quot;&gt;</b>の&quot;XX&quot;の部分に当てはめられて、置換されます。XHTML機の場合は、<b>&lt;IMG LOCALSRC=&quot;XX&quot;&gt;</b>の&quot;XX&quot;の部分に当てはめられて、置換されます。
<br></br><br></br><li> &lt;jphone&gt;要素<br></br>アクセスしてきた端末が、Vodafone/J-Phone端末であった場合、&lt;jphone&gt;要素に定義されている値に変換します。&lt;jphone&gt;要素は、&lt;string&gt;要素を保持していて、ここで定義されている値を直接使用します。</ol>

<p><br></br>emoji.xmlに定義されていない絵文字で、変換したい絵文字がある場合には、このファイルに新たな定義を足せば、変換するようになります。</p>

<div class="footnote">
<ol>
<li id="doc1_1130" value="10"> 厳密にはXMLになっていないので、日本語の記述はＳＪＩＳでお願いします。</ol>
</div>


<h2 id="doc1_1173">デバイス定義 device_data.xml</h2>

<p class="first_ja">mod_chxjの動作を決定付ける重要な定義です。変換対象の端末は全て、device_data.xmlファイルに定義される必要があります。定義されていない端末は、mod_chxjとしては、認識することができません。認識できない場合には、変換せずにそのまま出力します。ただし、Perl互換の正規表現によって定義できるため、正規表現の書き方によっては全ての機種に対応させることも可能です。</p>

<h2 id="doc1_1176">イメージ画像変換機能</h2>

<p class="first_ja">mod_chxjには、JPEG、GIF、PNG、BMPファイルを置いておくだけで、デバイス定義に従って、それぞれのキャリア対応のフォーマットに変換する機能があります。画像のサイズ（縦Ｘ横）も、端末の画面サイズに合わせて変換します。画像のサイズ（バイト数）については、デバイス定義中のキャッシュサイズを見て、その値よりも小さくなるように<b>努力</b>しますが、元の画像が大きすぎる場合や、複雑な画像の場合には、キャッシュサイズよりも小さくできずに表示できない場合があります。<br></br>それぞれのタグで指定する場合には、ファイル名の拡張子（.jpgや.gif等）をはずした形で指定します。<br></br>本機能には３つのモードが存在します。そのモードを以下に記します。</p>

<h3 id="doc1_1185">サムネイルモード</h3>

<p class="first_ja">端末側画面サイズの約３分の１程度のサイズ（縦Ｘ横）に画像を縮小表示します。</p>

<div id="doc1_1187" class="caption">サムネイルモード 使用例</div>
<pre class="program" style="margin-top:0">
  &lt;IMG SRC=&quot;/img/logo?Mode=Thumbnail&quot;&gt;
  
</pre>


<h3 id="doc1_1191">壁紙モード</h3>

<p class="first_ja">端末側画面のサイズにマッチするサイズに拡大・縮小します。横長の画像の場合には、縦幅を合わせた後に左右をトリミングします。</p>

<div id="doc1_1193" class="caption">壁紙モード 使用例</div>
<pre class="program" style="margin-top:0">
  &lt;IMG SRC=&quot;/img/logo?Mode=WP&quot;&gt;
  
</pre>


<h3 id="doc1_1197">EzGetモード</h3>

<p class="first_ja">壁紙ダウンロードを行いたい場合に使用します。EzGETモードは、壁紙モードで出力される画像サイズと同一サイズの画像が使用されます。</p>

<div id="doc1_1199" class="caption">EzGetモード 使用例</div>
<pre class="program" style="margin-top:0">
  &lt;A HREF=&quot;/img/logo?Mode=EzGet&quot;&gt;
  
</pre>


<h3 id="doc1_1203">その他の機能</h3>

<p class="first_ja">モードの他に、画像サイズ（縦Ｘ横）を直接指定することも可能です。<b>w</b>パラメータ、<b>h</b>パラメータを使用して指定します。</p>

<ol>
<li> wパラメータ<br></br>横幅を指定します。
<li> hパラメータ<br></br>縦幅を指定します。

<div id="doc1_1223" class="caption">w/hパラメータ 使用例</div>
<pre class="program" style="margin-top:0">
  &lt;IMG SRC=&quot;/img/logo?w=100&amp;h=200&quot;&gt;
  
</pre>

<li> User-Agentパラメータ（uaパラメータ）<br></br>User-Agentを指定します。指定した場合は、リクエストヘッダ中のUser-Agentを本パラメータの値で上書きします。このパラメータに&quot;IGN&quot;を指定した場合は、User-Agentを無視します。Thumbnailモード、壁紙モードと併用時は、640x480を元に画像サイズを算出します。</ol>

<p>上記全てのモード、パラメータはＧＥＴリクエストとしてのみ使用できます。</p>

<h2 id="doc1_1234">ＱＲコード出力機能</h2>


<h3 id="doc1_1236">ＱＲコード出力ハンドラの登録</h3>

<p class="first_ja">ＱＲコード出力機能を使用するには、ＱＲコードハンドラを登録します。httpd.confに以下の記述を追加します。</p>

<div id="doc1_1238" class="caption">httpd.conf</div>
<pre class="program" style="margin-top:0">
  AddHandler chxj-qrcode .qrc
</pre>

<p>なお、ハンドラを登録しないでも、出力フィルターを経由させることで、ＱＲコードを出力させることも可能です。（※ＱＲコードの動的出力を参照）</p>

<h3 id="doc1_1242">ＱＲコードソースファイルの設置</h3>

<p class="first_ja">ハンドラを登録したら、その登録した拡張子を持つファイルを用意します。</p>

<div id="doc1_1244" class="caption">例：a.qrc</div>
<pre class="program" style="margin-top:0">
  &lt;?xml version=1.0 ?&gt;
  
  &lt;qrcode&gt;
    &lt;version&gt;13&lt;/version&gt;
    &lt;level&gt;H&lt;/level&gt;
    &lt;mode&gt;8bit&lt;/mode&gt;
    &lt;size&gt;1&lt;/size&gt;
    &lt;data&gt;テストデータです&lt;/data&gt;
  &lt;/qrcode&gt;
</pre>

<p>.qrcファイルは、qrcode要素、version要素、level要素、mode要素、size要素、data要素から成り立ちます。</p>

<ol>
<li> versionタグversionタグは出力するＱＲコードの生成に利用するバージョンを指定します。使用できるバージョンは、１〜４０までの４０種類です。
<li> levelタグlevelタグは出力するＱＲコードの生成に利用する誤り検出レベルを指定します。　使用できるレベルは、L、Ｑ、Ｍ、Ｈの４つです。
<li> modeタグmodeタグは出力するＱＲコードの生成に利用するモードを指定します。使用できるモードは、NUM（数字モード）ALPHA（英数字モード）8BIT（８ビットバイトモード）KANJI（漢字モード）です。
<li> sizeタグsizeタグは１モジュールを何ピクセルであらわすかを指定します。０を指定した場合は、４を指定した場合と同じ動作をします。　使用できるサイズは、０〜２０までです。
<li> dataタグdataタグは、ＱＲコードに出力するデータを指定します。改行した場合は、改行文字もＱＲコード内に符号化されます。</ol>


<h3 id="doc1_1266">ＱＲコードの動的出力機能</h3>

<p class="first_ja">プログラム等を使用し、動的にＱＲコードを出力したい場合は、上記の.qrcファイルの内容をそのままOutputFilterに通してあげればＯＫです。つまり、ChxjConvertRuleディレクティブで&quot;EngineOn&quot;と指定したURIが指すディレクトリに設置すれば良いということです。mod_chxj内部で、Content-Typeがtext/xmlの場合、QRCode用のファイルであるかどうかを一度読み込んで判断するので、Content-Typeには、text/xmlを設定してください。</p>

<div id="doc1_1268" class="caption">phpでＱＲコードを動的に出力する例</div>
<pre class="program" style="margin-top:0">
    &lt;php
      $version = $_POST[&quot;version&quot;];
      $level   = $_POST[&quot;level&quot;];
      $mode    = $_POST[&quot;mode&quot;];
      $size    = $_POST[&quot;size&quot;];
      $data    = $_POST[&quot;data&quot;];

      header(&quot;Content-Type: text/xml; charset=Shift_JIS&quot;);

      echo &quot;&lt;qrcode&gt;\n&quot;;
      echo &quot;&lt;version&gt;&quot;.$version.&quot;&lt;/version&gt;\n&quot;;
      echo &quot;&lt;level&gt;&quot;.$level.&quot;&lt;/level&gt;\n&quot;;
      echo &quot;&lt;mode&gt;&quot;.$mode.&quot;&lt;/mode&gt;\n&quot;;
      echo &quot;&lt;size&gt;&quot;.$size.&quot;&lt;/size&gt;\n&quot;;
      echo &quot;&lt;data&gt;&quot;.$data.&quot;&lt;/data&gt;\n&quot;;
      echo &quot;&lt;/qrcode&gt;\n&quot;;
    &gt;
  
</pre>

<p>そして、上記のコードを、mod_chxj変換エンジンが処理するはずであるところに設置すれば完了です。</p>

<h2 id="doc1_1273">Cookieシミュレート機能(EXPERIMENTAL)</h2>


<h3 id="doc1_1275">Cookieシミュレート機能(EXPERIMENTAL)</h3>

<p class="first_ja">Cookieを受け付けない（無視する）端末のためにCookieをシミュレートします。本機能を有効にするためにはChxjConvertRuleディレクティブを使用する必要があります。ChxjConvertRuleディレクティブの第２パラメータにCookieOnを指定します。</p>

<div id="doc1_1277" class="caption">Cookieシミュレート機能を有効にする例</div>
<pre class="program" style="margin-top:0">
    ChxjConvertRule &quot;^/chxj.+$&quot; &quot;EngineOn,CookieOn&quot; &quot;NONE&quot;
  
</pre>


<h3 id="doc1_1281">One-Time ID</h3>

<p class="first_ja">Cookieシミュレートでは、aタグ、imgタグ、formタグのURL部にOne-Time IDを埋め込むことで実現します。そのため、ユーザがブラウザの戻るボタン等で戻った場合はCookieを取得できなくなります。</p>

<h3 id="doc1_1284">Cookieの保存場所</h3>

<p class="first_ja">Cookieの内容は、サーバ側に保存されます。保存ディレクトリはChxjCookieDirディレクティブを使用することで指定することができます。指定しなかった場合は、/tmpに保存されます。</p>

<div id="doc1_1286" class="caption">ChxjCookieDirの例</div>
<pre class="program" style="margin-top:0">
    ChxjCookieDir /var/abc
  
</pre>


<h3 id="doc1_1290">Cookieの保持期間</h3>

<p class="first_ja">ChxjCookieTimeoutディレクティブで保持期間を指定することができます。指定しなかった場合は1800秒でサーバに保存されているCookieは削除されます。</p>

<div id="doc1_1292" class="caption">ChxjCookieTimeoutの例</div>
<pre class="program" style="margin-top:0">
    &lt;Location /&gt;
      ChxjCookieTimeout 10
    &lt;/Location&gt;
  
</pre>

<p>上記の例は、10秒でタイムアウト(サーバから削除)するように指定しています。</p>

<h2 id="doc1_1297">Refererシミュレート機能(EXPERIMENTAL)</h2>


<h3 id="doc1_1299">Refererシミュレート機能(EXPERIMENTAL)</h3>

<p class="first_ja">DoCoMo端末などのRefererに対応していない機種のためにRefererシミュレート機能を提供します。本機能は、Cookieシミュレート機能を有効にすると、自動で有効になります(将来的には変更予定)。</p>
</body>
</html>
